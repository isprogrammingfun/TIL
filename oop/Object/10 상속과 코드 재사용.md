# 10 상속과 코드 재사용

- 객체지향 프로그래밍의 장점 중 하나는 코드를 재사용하기가 용이하다는 것이다.
- 객체지향에서는 코드를 재사용하기 위해 ‘새로운’ 코드를 추가한다.
- 객체지향에서 코드는 일반적으로 클래스 안에 작성되기 때문에 객체지향에서 클래스를 재사용하는 전통적인 방법은 새로운 클래스를 추가하는 것이다.

## 01 상속과 중복 코드

### DRY 원칙

- 중복 코드는 변경을 방해한다. 중복 코드는 코드를 수정하는 데 필요한 노력을 몇 배로 증가시킨다.
- 중복 여부를 판단하는 기준은 변경이다. 요구사항이 변경됐을 때 두 코드를 함께 수정해야 한다면 이 코드는 중복이다. 함께 수정할 필요가 없다면 중복이 아니다.
- 신뢰할 수 있고 수정하기 쉬운 소프트웨어를 만드는 효과적인 방법 중 하나는 중복을 제거하는 것이다.
- DRY(Don’t Repeat Yourself) 원칙을 따라야 한다.
    
    > DRY 원칙 : 모든 지식은 시스템 내에서 단일하고, 애매하지 않고, 정말로 믿을 만한 표현 양식을 가져야 한다.
    > 

### 중복과 변경

- 중복 코드는 새로운 중복 코드를 부른다. 중복 코드를 제거하지 않은 상태에서 코드를 수정할 수 있는 유일한 방법은 새로운 중복 코드를 추가하는 것뿐이다.
- 많은 코드 더미에서 중복 코드 파악이 쉽지 않고 중복은 항상 함께 수정해야 하기에 실수가 버그로 이어질 가능성이 높다.
- 중복 코드의 양이 많아질수록 버그의 수는 증가하며 그에 비례해 코드를 변경하는 속도는 점점 더 느려진다.
- 두 클래스의 중복을 제거하는 한 방법은 클래스를 하나로 합치는 것이다.
- 타입 코드를 사용해 타입에 따라 로직을 분기하면 된다.
- 하지만 타입 코드를 사용하는 클래스는 낮은 응집도와 높은 결합도라는 문제에 시달리게 된다.
- 객체지향 언어에서는 타입 코드를 사용하지 않고도 상속을 통해 효과적으로 중복 코드를 관리할 수 있다.

### 상속을 이용해서 중복 코드 제거하기

- 상속의 기본 아이디어는 이미 존재하는 클래스와 유사한 클래스가 필요하다면 코드를 복사하지 말고 상속을 이용해 코드를 재사용하라는 것이다.
- 상속을 염두에 두고 설계되지 않은 클래스를 상속을 이용해 재사용하는 것은 쉽지 않다.
- 상속을 이용해 코드를 재사용하기 위해서는 부모 클래스의 개발자가 세웠던 가정이나 추론 과정을 정확하게 이해해야 한다. 이는 자식 클래스의 작성자가 부모 클래스의 구현 방법에 대한 정확한 지식을 가져야 한다는 것을 의미한다.
- 따라서 상속은 결합도를 높인다. 그리고 상속이 초래하는 부모 클래스와 자식 클래스 사이의 강한 결합이 코드를 수정하기 어렵게 만든다.
- 코드 중복을 제거하기 위해 상속을 사용했음에도 세금을 계산하는 로직을 추가하기 위해 새로운 중복 코드를 만들어야 하는 경우도 있는데, 이는 구현에 너무 강하게 결합돼 있기 때문에 발생하는 문제이다.
    
    > 상속을 위한 경고 1 - 자식 클래스 메서드 안에서 super 참조를 이용해 부모를 직접 호출할 경우 두 클래스는 강하게 결합된다. super 호출을 제거할 수 있는 방법을 찾아 결합도를 제거하라.
    > 
- 상속 관계로 연결된 자식 클래스가 부모 클래스의 변경에 취약해지는 현상을 가리켜 취약한 기반 클래스 문제라고 부른다.
- 취약한 기반 클래스 문제는 코드 재사용을 목적으로 상속을 사용할 때 발생하는 가장 대표적인 문제다.

## 02 취약한 기반 클래스 문제

- 부모 클래스의 변경에 의해 자식 클래스가 영향을 받는 현상을 취약한 기반 클래스 문제라고 부른다.
- 상속 관계를 추가할수록 전체 시스템 결합도가 높아진다.
    - 자식 클래스의 기능 확장엔 용이하지만 높은 결합도로 인해 부모 클래스를 점진적으로 개선하는 것은 어렵게 만든다.
    - 최악의 경우 모든 자식 클래스를 수정하고 테스트해야 할 수도 있다.
- 취약한 기반 클래스 문제는 캡슐화를 약화시키고 결합도를 높인다.
    - 상속은 자식 클래스가 부모 클래스의 구현 세부사항에 의존하도록 만들기 때문에 캡슐화를 약화시킨다.
    - 캡슐화는 변경에 의한 파급효과를 제어할 수 있기 때문에 가치가 있다.
    - 상속을 사용하면 부모 클래스의 퍼블릭 인터페이스가 아닌 구현을 변경하더라도 자식 클래스의 영향을 받기 쉬워진다.
    - 상속은 코드의 재사용을 위해 캡슐화의 장점을 희석시키고 구현에 대한 결합도를 높임으로써 객체지향이 가진 강력함을 반감시킨다.

### 불필요한 인터페이스 상속 문제

- 인터페이스의 설계는 제대로 쓰기엔 쉽게, 엉터리로 쓰기엔 어렵게 만들어야 한다.
- 퍼블릭 인터페이스에 대한 고려 없이 단순히 코드 재사용을 위해 상속을 이용하는 것은 매우 위험하다. 단순히 코드를 재사용하기 위해 불필요한 오퍼레이션이 인터페이스에 스며들도록 방치해서는 안 된다.

> 상속을 위한 경고2 - 상속받은 부모 클래스 메서드가 자식 클래스 내부 구조에 대한 규칙을 깨트릴 수 있다.
> 

### 메서드 오버라이딩의 오작용 문제

> 상속을 위한 경고 3 - 자식 클래스가 부모 클래스의 메서드를 오버라이딩할 경우 부모 클래스가 자신의 메서드를 사용하는 방법에 자식 클래스가 결합될 수 있다.
> 
- 완벽한 캡슐화를 원한다면 코드 재사용을 포기하거나 다른 방법을 사용해야 한다.

### 부모 클래스와 자식 클래스의 동시 수정 문제

- 부모 클래스를 수정할 때 부모 클래스 메서드를 오버라이딩하거나 불필요한 인터페이스를 상속받지 않았음에도 자식 클래스도 함께 수정해야하는 경우가 있다.
- 상속을 사용하면 자식 클래스가 부모 클래스의 구현에 강하게 결합되기 때문에 이 문제를 피하기는 어렵다.
- 결합도란 다른 대상에 대해 알고 있는 지식의 양이다.
    - 상속은 기본적으로 부모 클래스의 구현을 재사용한다는 기본 전제를 따르기 때문에 자식 클래스가 부모 클래스의 내부에 대해 속속들이 알도록 강요한다.
    - 따라서 코드 재사용을 위한 상속은 부모 클래스와 자식 클래스를 강하게 결합시키기 때문에 함께 수정해야 하는 상황 역시 빈번하게 발생할 수밖에 없는 것이다.

> 상속을 위한 경고 4 - 클래스를 상속하면 결합도로 인해 자식 클래스와 부모 클래스 구현을 영원히 변경하지 않거나 자식 클래스와 부모 클래스를 동시에 변경하거나 둘 중 하나를 선택할 수밖에 없다.
> 

## 03 Phone 다시 살펴보기

### 추상화에 의존하자

- 자식 클래스가 부모 클래스의 구현이 아닌 추상화에 의존하도록 만들어야 한다.
    - 부모 클래스와 자식 클래스 모두 추상화에 의존하도록 수정해야 한다.
- 코드 중복 제거를 위해 상속을 도입할 때 두 가지 원칙은 다음과 같다.
    - 두 메서드가 유사하게 보인다면 차이점을 메서드로 추출하라. 메서드 추출을 통해 두 메서드를 동일한 형태로 보이도록 만들 수 있다.
    - 부모 클래스 코드를 하위로 내리지 말고 자식 클래스 코드를 상위로 올려라
        - 부모 클래스의 구체적인 메서드를 자식 클래스로 내리는 것보다 자식 클래스의 추상 메서드를 부모 클래스로 올리는 것이 재사용성과 응집도 측면에서 더 뛰어난 결과를 얻을 수 있다.

### 차이를 메서드로 추출하라

- 가장 먼저 할 일은 중복 코드 안에서 차이점을 별도의 메서드로 추출한다는 것이다.
    - 이는 “변하는 것으로부터 변하지 않는 것을 분리하라”, 또는 “변하는 부분을 찾고 이를 캡슐화하라”라는 조언을 메서드 수준에서 적용한 것이다.

### 중복 코드를 부모 클래스로 올려라

- 공통 부분을 추상 클래스로 구현한 부모 클래스로 이동시킨다.
- 공통 코드를 옮길 때 메서드를 먼저 이동시켜야 그에 필요한 인스턴스 변수를 컴파일 에러를 통해 알 수 있다.

### 추상화가 핵심이다

- 추상화를 통해 다음과 같은 장점을 얻을 수 있다.
    - 추상화에 의존하는 설계에서 각 클래스들은 서로 다른 변경 이유를 가진다
        - 단일 책임 원칙을 준수해 응집도가 높다.
    - 자식 클래스들은 부모 클래스의 구체적 구현이 아닌 추상화에 의존한다.
        - 메서드 시그니처가 변경되지 않는 한 부모 클래스 내부 구현이 바뀌어도 자식 클래스는 영향 받지 않는다. → 낮은 결합도
    - 부모 클래스 역시 자신의 내부에 구현된 추상 메서드를 호출하기 때문에 추상화에 의존한다.
        - 의존성 역전 원칙 준수
    - 새로운 자식 클래스를 생성하기 쉽다.

### 의도를 드러내는 이름 선택하기

- 구현하는 내용을 명시적으로 표현할 수 있는 이름을 선택해야 한다.

### 세금 추가하기

- 클래스 사이의 상속은 부모 클래스가 구현한 행동뿐만 아니라 인스턴스 변수에 대해서도 결합되게 만든다.
    - 행동만 변경된다면 상속 계층의 각 클래스들을 독립적으로 진화시킬 수 있다.
    - 하지만 변수가 추가된다면 상속 계층 전반에 걸친 변경을 유발한다.
- 그래도 인스턴스 초기화 로직을 변경하는 것이 동일한 코드를 중복시키는 것보다는 현명하다.
- 상속으로 인한 클래스 간 결합을 피할 수 있는 방법은 없다.

## 04 차이에 의한 프로그래밍

- 기존 코드와 다른 부분만을 추가함으로써 애플리케이션의 기능을 확장하는 방법을 차이에 의한 프로그래밍이라고 부른다.
    - 차이에 의한 프로그래밍의 목표는 중복 코드를 제거하고 코드를 재사용하는 것이다.
- 중복을 제거하기 위해서는 코드를 재사용 가능한 단위로 분해하고 재구성해야 한다.
- 코드를 재사용하기 위해서는 중복코드를 제거해서 하나의 모듈로 모아야 한다.
- 재사용 가능한 코드란 심각한 버그가 존재하지 않는 코드다.
- 객체지향 세계에서 중복 코드를 제거하고 코드를 재사용할 수 있는 가장 유명한 방법은 상속이다.
- 상속이 코드 재사용 측면에서 매우 강력한 도구이지만 오용과 남용은 확장하기 어렵게 만든다.
- 상속의 단점을 피하면서도 코드를 재사용할 수 있는 더 좋은 방법이 바로 합성이다.