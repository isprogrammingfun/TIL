## 플라이웨이트 패턴

### 플라이웨이트 패턴이란?

플라이웨이트 패턴(Flyweight Pattern)은 재사용 가능한 객체 인스턴스를 공유시켜 메모리 사용량을 최소화하는 구조 패턴이다. 간단히 말하면 캐시(Cache) 개념을 코드로 패턴화 한 것으로 보면 되는데, 자주 변하는 속성과 변하지 않는 속성을 분리하고 변하지 않는 속성을 캐시한 뒤 재사용해 메모리 사용을 줄이는 방식이다. 그래서 동일하거나 유사한 객체들 사이에 가능한 많은 데이터를 서로 공유하고 사용하도록 하여 최적화를 노리는 경량 패턴이라고도 불린다.

### 플라이웨이트 패턴의 구조

![structure-indexed](https://github.com/isprogrammingfun/TIL/assets/78543382/b6e5ee15-97ed-419d-a733-8dfe9b551dff)

1. 플라이웨이트 : 플라이웨이트 클래스에는 여러 객체들 간에 공유할 수 있는 원래 객체의 상태의 부분이 포함된다. 플라이웨이트 객체는 다양한 콘텍스트에서 사용될 수 있다. 플라이웨이트 내부에 저장된 상태를 고유한(intrinsic) 상태라고 하며, 플라이웨이트 메서드에 전달된 상태를 공유한(extrinsic) 상태라고 한다. 
2. 콘텍스트 : 콘텍스트 클래스는 공유한 상태를 포함하며, 이 상태는 모든 원본 객체들에서 고유하다. 콘텍스트가 플라이웨이트 객체 중 하나와 쌍을 이루면 원래 객체의 전체 상태를 나타낸다.  
3. 클라이언트 : 클라이언트는 플라이웨이트들의 공유된 상태를 저장하거나 계산한다. 클라이언트의 관점에서 플라이웨이트는 일부 콘텍스트 데이터를 그의 메서드들의 매개변수들에 전달하여 런타임에 설정될 수 있는 템플릿 객체이다.
4. 플라이웨이트 팩토리 : 플라이웨이트 팩토리는 기존 플라이웨이트들의 풀을 관리한다. 이 팩토리로 인해 클라이언트들은 플라이웨이드들을 직접 만들지 않는 대신 원하는 플라이웨이트의 고유한 상태의 일부를 전달하여 팩토리를 호출한다. 팩토리는 이전에 생성된 플라이웨이트들을 살펴보고 검색 기준과 일치하는 기존 플라이웨이트를 반환하거나 기준에 맞는 플라이웨이트가 발견되지 않으면 새로 생성한다.

### Intrinsic & Extrinsic

intrinsic이란 '고유한, 본질적인' 이라는 의미를 가진다. 본질적인 상태란 인스턴스가 어떠한 상황에서도 변하지 않는 정보를 말한다. 그래서 값이 고정되어 있기에 충분히 언제 어디서 공유해도 문제가 없게 된다.

extrinsic이란 '외적인, 비본질적인' 이라는 의미를 가진다. 인스턴스를 두는 장소나 상황에 따라서 변화하는 정보를 말한다. 그래서 값이 언제 어디서 변화할지 모르기 때문에 이를 캐시해서 공유할 수 는 없다.

정리하자면 intrinsic한 객체는 장소나 상황에 의존하지 않기 때문에 값이 고정되어 공유할 수 있는 객체이고, extrinsic한 객체는 장소나 상황에 의존하기 때문에 매번 값이 바뀌어 공유할 수 없는 객체이다. 

### 언제 사용하는가?

1. 어플리케이션에 의해 생성되는 객체의 수가 많아 저장 비용이 높아질 때
2. 생성된 객체가 오래도록 메모리에 상주하며 사용되는 횟수가 많을때
3. 공통적인 인스턴스를 많이 생성하는 로직이 포함된 경우
4. 임베디드와 같이 메모리를 최소한으로 사용해야 하는 경우

### 패턴 장점

1. 애플리케이션에서 사용하는 메모리를 줄일 수 있다.
2. 프로그램 속도를 개선할 수 있다.
    - 객체를 공유하면 인스턴스를 가져오기만 하면 되기 때문에 메모리 뿐만 아니라 속도도 향상시킬 수 있게 된다.

### 패턴 단점

1. 코드의 복잡도가 증가한다.

### 참고자료

[https://inpa.tistory.com/entry/GOF-💠-Flyweight-패턴-제대로-배워보자](https://inpa.tistory.com/entry/GOF-%F0%9F%92%A0-Flyweight-%ED%8C%A8%ED%84%B4-%EC%A0%9C%EB%8C%80%EB%A1%9C-%EB%B0%B0%EC%9B%8C%EB%B3%B4%EC%9E%90)

https://refactoring.guru/ko/design-patterns/flyweight

[https://velog.io/@hoit_98/디자인-패턴-Flyweight-패턴](https://velog.io/@hoit_98/%EB%94%94%EC%9E%90%EC%9D%B8-%ED%8C%A8%ED%84%B4-Flyweight-%ED%8C%A8%ED%84%B4)